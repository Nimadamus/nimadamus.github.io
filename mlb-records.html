<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>MLB Records</title>
<link rel="icon" href="/newlogo.png" type="image/png"/>
<script src="https://cdn.jsdelivr.net/npm/papaparse@5.4.1/papaparse.min.js"></script>
<style>
  :root {
    --bg: #000;
    --panel: #0b0b0b;
    --border: #1e1e1e;
    --teal: #00e0ff;
    --muted: #8aa1a8;
  }
  html,body{margin:0;background:var(--bg);color:#fff;font-family:Arial,Helvetica,sans-serif}
  .wrap{max-width:1200px;margin:0 auto;padding:18px}
  h1{text-align:center;margin:8px 0 16px;font-size:30px;letter-spacing:1px;text-shadow:0 0 12px rgba(0,224,255,.45)}
  .ticker{margin:10px auto 16px;max-width:980px;background:var(--panel);border:1px solid var(--border);border-radius:10px;
          padding:10px 14px;overflow:hidden;white-space:nowrap}
  .tiles{display:grid;grid-template-columns:repeat(4,1fr);gap:14px;margin:10px 0 18px}
  .tile{background:var(--panel);border:1px solid var(--teal);border-radius:10px;padding:16px;text-align:center}
  .tile .label{font-size:12px;color:var(--muted);letter-spacing:.5px;margin-bottom:6px;display:block}
  .tile .value{font-size:24px}
  .section{margin:18px 0 10px;font-size:20px;color:var(--teal);text-shadow:0 0 6px rgba(0,224,255,.3)}
  table{width:100%;border-collapse:collapse;font-size:14px}
  th,td{padding:8px;border-bottom:1px solid #222;text-align:left}
  th{background:#0f2024;color:#bfefff;position:sticky;top:0}
  .frame{height:65vh;border:1px solid var(--border);border-radius:12px;overflow:hidden;background:var(--panel);margin-top:18px}
  iframe{width:100%;height:100%;border:0;background:var(--panel)}
  .muted{color:var(--muted)}
</style>
</head>
<body>
  <div class="wrap">
    <h1>MLB Records</h1>

    <div id="ticker" class="ticker muted">Loading latest pick…</div>

    <div class="tiles">
      <div class="tile"><span class="label">OVERALL RECORD</span><div class="value" id="overall">--</div></div>
      <div class="tile"><span class="label">TOTAL UNITS</span><div class="value" id="totalUnits">--</div></div>
      <div class="tile"><span class="label">WIN PERCENTAGE</span><div class="value" id="winPct">--</div></div>
      <div class="tile"><span class="label">AVERAGE ODDS</span><div class="value" id="avgOdds">--</div></div>
    </div>

    <div class="section">Monthly Breakdown</div>
    <table id="monthlyTbl">
      <thead><tr><th>Month</th><th>Record</th><th>Units</th></tr></thead>
      <tbody></tbody>
    </table>

    <div class="section">Full Betting History</div>
    <table id="historyTbl">
      <thead><tr><th>Date</th><th>Pick</th><th>Line</th><th>Result</th><th>Units</th></tr></thead>
      <tbody></tbody>
    </table>

    <div class="section">Live Sheet)</div>
    <div class="frame">
      <iframe src="https://docs.google.com/spreadsheets/d/e/2PACX-1vQE9RjSNABgl0SxSA1ghp9soUs4gq7teoncN5GLmG5faXmH-sDwXgg0mrk0iQwmSEYExtx6xwFMflXv/pubhtml?gid=121997960&single=true&widget=true&headers=false"></iframe>
    </div>
  </div>

<script>
const CSV_URL = 'https://docs.google.com/spreadsheets/d/e/2PACX-1vQE9RjSNABgl0SxSA1ghp9soUs4gq7teoncN5GLmG5faXmH-sDwXgg0mrk0iQwmSEYExtx6wFMflXv/pub?gid=121997960&single=true&output=csv';

function parseNum(v) {
  if (v === null || v === undefined) return NaN;
  // convert like '-110', ' -1.25 ', etc.
  const t = String(v).replace(/[^0-9.+-]/g, '').trim();
  return t ? Number(t) : NaN;
}

function formatPct(x) { return isFinite(x) ? (x).toFixed(1) + '%' : '--'; }
function formatUnits(x) { return isFinite(x) ? (x >= 0 ? '+' : '') + x.toFixed(2) + 'u' : '--'; }

function monthKey(d) { return d.getFullYear() + '-' + String(d.getMonth()+1).padStart(2,'0'); }
function monthLabel(key) {
  const [y,m] = key.split('-').map(Number);
  return new Date(y, m-1, 1).toLocaleString(undefined, { month:'long', year:'numeric' });
}

function computeStats(rows) {
  let wins=0, losses=0, pushes=0, units=0, oddsSum=0, oddsN=0;
  const monthAgg = new Map();

  for (const r of rows) {
    const res = (r.Result || '').trim().toUpperCase();
    const u = parseNum(r.Units);
    if (!isNaN(u)) units += u;
    if (res === 'W') wins++;
    else if (res === 'L') losses++;
    else if (res === 'P') pushes++;

    const line = parseNum(r.Line);
    if (!isNaN(line)) { oddsSum += line; oddsN++; }

    // monthly
    if (r._date instanceof Date && !isNaN(r._date)) {
      const key = monthKey(r._date);
      if (!monthAgg.has(key)) monthAgg.set(key, { wins:0, losses:0, pushes:0, units:0 });
      const m = monthAgg.get(key);
      if (res === 'W') m.wins++;
      else if (res === 'L') m.losses++;
      else if (res === 'P') m.pushes++;
      if (!isNaN(u)) m.units += u;
    }
  }

  const wl = wins + losses;
  const winPct = wl > 0 ? (wins / wl) * 100 : NaN;
  const avgOdds = oddsN > 0 ? oddsSum / oddsN : NaN;

  return { wins, losses, pushes, units, winPct, avgOdds, monthAgg };
}

function render(rows) {
  // latest for ticker = max by date (fallback to last row)
  let latest = rows.filter(r => r._date instanceof Date && !isNaN(r._date)).sort((a,b)=>b._date - a._date)[0] || rows[rows.length-1];
  const tick = document.getElementById('ticker');
  if (latest) {
    const d = latest._date instanceof Date && !isNaN(latest._date) ? latest._date.toLocaleDateString() : (latest.Date||'');
    tick.textContent = `${d}  —  ${latest.Pick||''}  (Line: ${latest.Line||''})  Result: ${latest.Result||''}  Units: ${latest.Units||''}`;
    tick.classList.remove('muted');
  }

  const s = computeStats(rows);
  document.getElementById('overall').textContent = `${s.wins}–${s.losses}${s.pushes?('–'+s.pushes+' P'):''}`;
  document.getElementById('totalUnits').textContent = formatUnits(s.units);
  document.getElementById('winPct').textContent = formatPct(s.winPct);
  document.getElementById('avgOdds').textContent = isFinite(s.avgOdds) ? s.avgOdds.toFixed(0) : '--';

  // monthly table
  const mtbody = document.querySelector('#monthlyTbl tbody');
  mtbody.innerHTML = '';
  const keys = Array.from(s.monthAgg.keys()).sort(); // chronological
  for (const key of keys) {
    const m = s.monthAgg.get(key);
    const wl = m.wins + m.losses;
    const rec = `${m.wins}–${m.losses}${m.pushes?('–'+m.pushes+' P'):''}`;
    const tr = document.createElement('tr');
    tr.innerHTML = `<td>${monthLabel(key)}</td><td>${rec}</td><td>${formatUnits(m.units)}</td>`;
    mtbody.appendChild(tr);
  }

  // history table
  const htbody = document.querySelector('#historyTbl tbody');
  htbody.innerHTML = '';
  // sort descending by date if possible
  const sorted = rows.slice().sort((a,b)=>{
    if (a._date && b._date) return b._date - a._date;
    return 0;
  });
  for (const r of sorted) {
    const d = r._date instanceof Date && !isNaN(r._date) ? r._date.toLocaleDateString() : (r.Date||'');
    const tr = document.createElement('tr');
    tr.innerHTML = `<td>${d}</td><td>${r.Pick||''}</td><td>${r.Line||''}</td><td>${r.Result||''}</td><td>${r.Units||''}</td>`;
    htbody.appendChild(tr);
  }
}

Papa.parse(CSV_URL, {
  download: true, header: true, skipEmptyLines: 'greedy',
  complete: (res) => {
    const raw = res.data;
    // map/clean rows
    const rows = raw.map(r => ({ 
      Date: r['Date'] ?? r['date'] ?? '',
      Sport: r['Sport'] ?? r['sport'] ?? '',
      Pick: r['Pick'] ?? r['pick'] ?? '',
      Line: r['Line'] ?? r['line'] ?? '',
      Result: r['Result'] ?? r['result'] ?? '',
      Units: r['Units'] ?? r['units'] ?? ''
    })).filter(r => (r.Pick||'').toString().trim() !== '');

    // parse dates
    for (const r of rows) {
      const d = new Date(r.Date);
      r._date = isNaN(d) ? null : d;
    }
    render(rows);
  },
  error: (err) => {
    document.getElementById('ticker').textContent = 'Error loading CSV';
    console.error(err);
  }
});
</script>
</body>
</html>
