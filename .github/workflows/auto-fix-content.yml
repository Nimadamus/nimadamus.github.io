name: Auto-Fix and Validate Content

# CHANGED Feb 20, 2026: Removed push trigger to stop cascade spam
# This now runs on daily schedule + manual only
# The push trigger was causing: push → auto-fix pushes → triggers itself again → repeat
on:
  schedule:
    # Run every day at 10:00 AM ET (15:00 UTC) to sync graded picks
    - cron: '0 15 * * *'
  workflow_dispatch:
    # Allow manual trigger from GitHub Actions UI

jobs:
  validate-and-fix:
    runs-on: ubuntu-latest
    permissions:
      contents: write

    steps:
      - name: Checkout repository
        uses: actions/checkout@v4
        with:
          fetch-depth: 0

      - name: Set up Python
        uses: actions/setup-python@v5
        with:
          python-version: '3.11'

      - name: Fix college logos (convert abbreviations to numeric IDs)
        continue-on-error: true
        run: |
          echo "Fixing college logo URLs..."
          python scripts/college_logo_ids.py

      - name: Sync all calendars
        continue-on-error: true
        run: |
          echo "Syncing all sport calendars..."
          python scripts/sync_calendars.py

      - name: Sync featured games data (scan pages - update data file)
        continue-on-error: true
        run: |
          echo "Scanning featured game pages for missing entries..."
          python scripts/sync_featured_games_data.py

      - name: Sync featured games calendar (data file - calendar JS)
        continue-on-error: true
        run: |
          echo "Syncing featured games calendar..."
          python scripts/sync_featured_games_calendar.py

      - name: Sync records from Pick Tracker
        continue-on-error: true
        run: |
          echo "Syncing records from Pick Tracker..."
          python scripts/sync_records_from_tracker.py

      - name: Commit and push fixes
        run: |
          git config --local user.email "action@github.com"
          git config --local user.name "GitHub Action Bot"
          git add -A
          if git diff --staged --quiet; then
            echo "No changes needed"
          else
            git commit -m "Auto-sync: calendars, logos, records"
            git push || echo "Push failed - will retry next scheduled run"
          fi
