name: Update Odds Page Daily

on:
  schedule:
    - cron: '0 14 * * *'
  workflow_dispatch:

jobs:
  update-odds:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout repository
        uses: actions/checkout@v3

      - name: Fetch MLB odds
        run: |
          curl "https://api.the-odds-api.com/v4/sports/baseball_mlb/odds/?regions=us&markets=h2h,spreads,totals&bookmakers=fanduel&apiKey=c405ed8a7e1f4ec945d39aeeaf647e4b" -o raw_odds.json

      - name: Inject odds into HTML
        run: |
          python3 - <<EOF
          import json

          with open('raw_odds.json') as f:
              data = json.load(f)

          html = '<h2>MLB Odds (Fanduel)</h2><table border="1" cellpadding="6"><tr><th>Matchup</th><th>Moneyline</th><th>Run Line</th><th>Total</th></tr>'

          for game in data:
              teams = f"{game['home_team']} vs {game['away_team']}"
              markets = {m['key']: m for m in game['bookmakers'][0]['markets']}

              ml = ' / '.join(f"{o['name']} {o['price']}" for o in m
