<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Verified Records - BetLegend</title>
    <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@500;700;900&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;700&display=swap" rel="stylesheet">
    <style>
        :root {
            --glow-color: #00e0ff;
            --win-color: #39FF14;
            --loss-color: #FF3131;
            --push-color: #888;
        }
        body {
            background-color: #000;
            background-image: url('https://images.unsplash.com/photo-1534796636912-3b95b3ab5986?q=80&w=2071&auto=format&fit=crop');
            background-size: cover;
            background-position: center;
            background-attachment: fixed;
            font-family: 'Orbitron', sans-serif;
            color: white;
            margin: 0;
            padding: 20px;
        }
        .container {
            max-width: 1000px;
            margin: 40px auto;
            padding: 25px;
            background: rgba(0, 0, 0, 0.7);
            border: 1px solid var(--glow-color);
            border-radius: 15px;
            box-shadow: 0 0 35px rgba(0, 224, 255, 0.5);
            backdrop-filter: blur(10px);
        }
        .header {
            text-align: center;
            margin-bottom: 30px;
        }
        .header h1 {
            font-size: 48px;
            font-weight: 900;
            color: #fff;
            text-shadow: 0 0 10px rgba(255, 255, 255, 0.5), 0 0 25px var(--glow-color);
        }
        .header h1 span { color: var(--glow-color); }
        .description {
            text-align: center;
            font-family: 'Roboto', sans-serif;
            color: #ccc;
            line-height: 1.6;
            max-width: 800px;
            margin: 0 auto 20px auto;
            padding: 20px;
            border: 1px solid rgba(0, 224, 255, 0.2);
            border-radius: 8px;
        }
        .last-updated { font-size: 14px; color: #888; margin-top: 10px; }
        .stats-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin-bottom: 30px;
            text-align: center;
        }
        .stat-box {
            background: rgba(17, 17, 17, 0.8);
            padding: 20px;
            border-radius: 8px;
            border: 1px solid var(--glow-color);
        }
        .stat-box h3 {
            margin: 0 0 10px 0;
            font-size: 16px;
            color: var(--glow-color);
            text-transform: uppercase;
        }
        .stat-box p {
            margin: 0;
            font-family: 'Roboto', sans-serif;
            font-size: 28px;
            font-weight: 700;
        }
        .stat-box .units-win { color: var(--win-color); }
        .stat-box .units-loss { color: var(--loss-color); }

        .table-container { overflow-x: auto; }
        table {
            width: 100%;
            border-collapse: collapse;
            font-family: 'Roboto', sans-serif;
        }
        th, td {
            padding: 12px 15px;
            text-align: left;
        }
        thead tr {
            background-color: rgba(0, 224, 255, 0.15);
            color: var(--glow-color);
            font-family: 'Orbitron', sans-serif;
            font-size: 14px;
            text-transform: uppercase;
        }
        tbody tr { border-bottom: 1px solid rgba(0, 224, 255, 0.2); }
        tbody tr:last-child { border-bottom: none; }
        td { color: #ddd; }
        .result-W { font-weight: bold; color: var(--win-color); }
        .result-L { font-weight: bold; color: var(--loss-color); }
        .result-P { font-weight: bold; color: var(--push-color); }
        .no-picks-message {
            text-align: center;
            padding: 40px;
            font-size: 18px;
            color: #888;
        }
        .loading-message {
            text-align: center; padding: 50px; font-size: 20px; color: var(--glow-color);
        }
        .nav-home { display: block; text-align: center; margin-top: 30px; }
        .nav-home a { color: var(--glow-color); text-decoration: none; font-weight: bold; }
        .nav-home a:hover { text-shadow: 0 0 8px var(--glow-color); }
    </style>
</head>
<body>

    <div class="container">
        <div class="header">
            <h1>Verified<span>Records</span></h1>
        </div>
        <div class="description">
            This page shows the official combined record for BetLegend across all sports. Every pick is logged on the day it is posted and graded after the game. The table lists the date, pick, line, result, and units, and the running total so visitors can audit the entire Betting History at a glance. Nothing is hidden or removed.
            <div class="last-updated" id="last-updated-date">Last updated: ...</div>
        </div>

        <div class="stats-grid">
            <div class="stat-box">
                <h3>Overall Record</h3>
                <p id="overall-record">0-0-0</p>
            </div>
            <div class="stat-box">
                <h3>Total Units</h3>
                <p id="total-units">+0.00</p>
            </div>
        </div>

        <div class="table-container">
            <table>
                <thead>
                    <tr>
                        <th>Date</th>
                        <th>Sport</th>
                        <th>Pick</th>
                        <th>Line</th>
                        <th>Result</th>
                        <th>Units</th>
                    </tr>
                </thead>
                <tbody id="picks-table-body">
                    <!-- Data will be loaded here -->
                </tbody>
            </table>
            <div id="loading-message" class="loading-message">Loading record...</div>
        </div>
        <div class="nav-home">
             <a href="/">‚Üê Back to Homepage</a>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/papaparse@5.3.2/papaparse.min.js"></script>
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // --- CONFIGURATION ---
            const sheetUrls = [
                "https://docs.google.com/spreadsheets/d/e/2PACX-1vTJHvgLVm48LPxFgZQvTca47OwpWQdqh2RANE2ZFhP67-Qb-cQXPUFJDZtUCnChIkwq5mxQNjYgAGMw/pub?gid=121997960&single=true&output=csv",
                "https://docs.google.com/spreadsheets/d/e/2PACX-1vQ9c45xiuXWNe-fAXYMoNb00kCBHfMf4Yn-Xr2LUqdCIiuoiXXDgrDa5mq1PZqxjg8hx-5KnS0L4uVU/pub?gid=0&single=true&output=csv",
                "https://docs.google.com/spreadsheets/d/e/2PACX-1vQgB4WcyyEpMBp_XI_ya6hC7Y8kRaHzrOvuLMq9voGF0nzfqi4lkmAWVb92nDkxUhLVhzr4RTWtZRxq/pub?gid=0&single=true&output=csv"
            ];

            // --- ELEMENT SELECTORS ---
            const overallRecordEl = document.getElementById('overall-record');
            const totalUnitsEl = document.getElementById('total-units');
            const tableBodyEl = document.getElementById('picks-table-body');
            const loadingMessageEl = document.getElementById('loading-message');
            const lastUpdatedEl = document.getElementById('last-updated-date');

            // --- HELPER FUNCTION ---
            function parseDate(dateStr) {
                if (!dateStr) return null;
                const s = String(dateStr).trim();
                let m = s.match(/^(\d{1,2})[\/\-](\d{1,2})[\/\-](\d{2,4})$/);
                if (m) {
                    const mo = +m[1] - 1, d = +m[2]; let y = +m[3];
                    if (y < 100) y += 2000;
                    return (y > 2000 && mo >= 0 && mo < 12 && d > 0 && d <= 31) ? new Date(y, mo, d) : null;
                }
                m = s.match(/^(\d{4})[\/\-](\d{1,2})[\/\-](\d{1,2})$/);
                if (m) {
                    const y = +m[1], mo = +m[2] - 1, d = +m[3];
                    return (mo >= 0 && mo < 12 && d > 0 && d <= 31) ? new Date(y, mo, d) : null;
                }
                return null;
            }

            // --- MAIN FUNCTION ---
            async function loadAndDisplayRecords() {
                const fetchAndParse = (url) => new Promise((resolve, reject) => {
                    Papa.parse(url, {
                        download: true, header: true, skipEmptyLines: 'greedy',
                        transformHeader: h => h.trim(),
                        complete: resolve, error: reject
                    });
                });

                const resultsArray = await Promise.allSettled(sheetUrls.map(fetchAndParse));

                let allPicks = [];
                resultsArray.forEach(result => {
                    if (result.status === 'fulfilled' && result.value.data) {
                        allPicks = allPicks.concat(result.value.data);
                    }
                });

                const gradedPicks = allPicks
                    .filter(p => p.Result && p.Result.trim() !== '' && p.Units && !isNaN(parseFloat(p.Units)))
                    .map(p => ({...p, parsedDate: parseDate(p.Date) }))
                    .filter(p => p.parsedDate)
                    .sort((a, b) => b.parsedDate - a.parsedDate);
                
                loadingMessageEl.style.display = 'none';

                if (gradedPicks.length === 0) {
                    tableBodyEl.innerHTML = `<tr><td colspan="6" class="no-picks-message">No graded picks found in the record yet.</td></tr>`;
                    return;
                }

                // Calculate stats
                let wins = 0, losses = 0, pushes = 0, totalUnits = 0.0;
                gradedPicks.forEach(p => {
                    const result = p.Result.trim().toUpperCase();
                    if (result === 'W' || result === 'WIN') wins++;
                    else if (result === 'L' || result === 'LOSS') losses++;
                    else if (result === 'P' || result === 'PUSH') pushes++;
                    totalUnits += parseFloat(p.Units);
                });

                // Update stat boxes
                overallRecordEl.textContent = `${wins}-${losses}-${pushes}`;
                totalUnitsEl.textContent = `${totalUnits >= 0 ? '+' : ''}${totalUnits.toFixed(2)}`;
                totalUnitsEl.className = totalUnits >= 0 ? 'units-win' : 'units-loss';
                
                // Update last updated date
                lastUpdatedEl.textContent = `Last updated: ${new Date().toLocaleDateString()}`;

                // Populate table
                let tableHTML = '';
                gradedPicks.forEach(p => {
                    tableHTML += `
                        <tr>
                            <td>${p.Date.trim()}</td>
                            <td>${p.Sport ? p.Sport.trim() : 'N/A'}</td>
                            <td>${p.Pick.trim()}</td>
                            <td>${p.Line ? p.Line.trim() : 'N/A'}</td>
                            <td class="result-${p.Result.trim().toUpperCase().charAt(0)}">${p.Result.trim()}</td>
                            <td>${parseFloat(p.Units).toFixed(2)}</td>
                        </tr>
                    `;
                });
                tableBodyEl.innerHTML = tableHTML;
            }

            loadAndDisplayRecords().catch(err => {
                 loadingMessageEl.textContent = 'Error loading records. Please try again later.';
                 console.error(err);
            });
        });
    </script>

</body>
</html>
